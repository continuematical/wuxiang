# 相关概念

### 数据库

DB数据库：存储数据的仓库，本质是一个文件系统，保存了一系列有组织的数据；

DBMS数据库管理系统：通过管理系统管理数据库；

SQL结构化查询语言

### RDBMS和非RDBMS

#### 关系型数据库

- 关系型数据库模型是把复杂的数据模型归为简单的二元关系（二维表格形式）；

- 关系型数据库以行和列的形式存储数据，以便于理解，这一系列的行和列被称为**表**，一组表组成了一个数据库；

- 表与表之间的数据记录有关系，关系型数据库就是建立在关系模型基础上的数据库；

- 优势

  复杂查询；

  事务支持：对于线程安全性的访问呢得以支持；

#### 非关系型数据库

关系型数据库的轻量级版本，基于**键值对**存储数据，不需要警告SQL层的解析，性能高；

**键值型数据库**

通过key-value键值的方式来存储数据，key作为唯一的标识符，优点是查找快，缺点是无法像关系型数据库那样使用条件型过滤；

典型使用场景：内存缓存；Redis

**文档型数据库**

可以存放并获取文档，可以是XML，JSON等格式，在数据库中文档作为处理数据库的基本单位，一条文档就是一条记录，文档数据库所存放的文档，就相当于键值数据库的“值”；

MongoDB，CouchDB

**搜索引擎数据库**

应用在搜索引擎的数据存储格式，会爬取大量的数据，并以特定的格式进行存储，这样在检索的时候才能保证性能最优，核心原理是“倒排索引”；

**列式数据库**

相对于行式存储，按列存储到数据库中，好处是降低系统的I/O，适合分布式文件系统，不足在于功能相对有限；

HBase；

**图形数据库**

利用图这种数据结构存储实体对象之间的关系，数据模型主要是节点和边来实现，高效解决复杂关系；

### 关系型数据库设计原则

#### 表，记录，字段

E-R模型的主要三个概念：

- 一个**实体集**对应数据库的一个表；
- 一个**实体**对应数据库的一行，即一条记录；
- 一个**属性**对应数据库的一列，即一个字段；

#### 表的关联关系

**一对一关联（one-to-one）**

实际开发中应用不多；

两种建表原则：

1. 外键唯一：主表的主键和表的外键唯一，形成主外键关系，外键唯一；
2. 外键是主键：主表的主键和从表的外键构成主外键关系；

**一对多关联（one-to-many）**

建表原则：在从表（多方）创建字段，字段作为外键指向主表（一方的）主键；

**多对多关联（many-to-many）**

要表示多对多关系，必须创建第三个表该表通常为**联接表**，它将多对多关系划分为两个一对多关系，这两个表的主键插入到第三个表中；

**自主引用（self reference）**

### MySQL目录结构

#### bin目录

所有MySQL的可执行文件；

#### data目录

系统数据库；

#### my.ini文件

MySQL的主要配置文件；

### SQL分类

在功能上可分为如下几类：

#### **DDL**数据定义语言

定义不同的数据库、表、索引、视图等数据库对象，还可以用来修改、创建、删除数据库和数据表的内容；

```sql
CREATE,DROP,ALTER/*修改数据*/,RENAME,TRUNCATE/*清空数据*/
```

#### DML数据操作语言

增删查改；

```sql
INSERT,DELETE,UPDATE,SELECT
```

#### DCL数据控制语言

用于定义数据库，表，字段，用户访问权限和安全级别；

```sql
COMMIT,ROLLBACK,SAVEPOINT
```

# 语法

## SQL语言基本规则

每条命令以`\g` 结束（=;）,`\G` 表示将查询结果进行按列打印，可以使每个字段打印到相应的行；

字符串、日期时间类型的数据可以使用单引号表示；

注释

```mysql
/*注释文字*/
#注释文字
-- 注释文字（后面必须包含一个空格）
```

导入现有的数据表

- 命令行
  `source 文件全路径名` 
- 图形化界面

## SELECT语句

`select 字段1，字段2 from 表名` 

### 通配符

由于不明确指定类名，所以会检索出名字未知的列；

### 列的别名

**结果集**select语句返回的结果集合；

**as（alias）**类的别名；

还可以使用双引号；

```mysql
SELECT name "na",ID FROM emp;
SELECT name AS na,ID FROM emp;
```

### 去除重复行

关键字`distinct` ，必须放在列名的前面；

### 限制结果

`LIMIT` +检索行数；

`LIMIT`+检索开始的行数，检索行数；

### 空值参与运算

所有运算符或行列值遇到null值，运算的结果都为null；

**空值**即为NULL，不等同于`0/' '` ，

实际问题的解决方案：

引入`IFFULL(原值，若为NULL替换的值)` 

### 着重号

'字段名'  和关键字重复的字段名；

### 显示表的结构

`DESCRIBE`  表名

显示了表中字段的详尽信息；

### 使用`WHERE` 过滤数据

## 运算符

### 算术运算符

#### **加号**

SQL语法中的加号只有算数作用，不能起连接作用；

```mysql
SELECT 14+'1' FROM emp;/*15*/
SELECT 14+'a' FROM emp;/*14，字母自动转化为0，隐式转换*/
```

#### **取余（%/mod）**

结果数的符号和**被模数**的符号一样；

### 比较运算符

表示对表达运算式左边和右边的操作数进行比较的运算，有三种结果，**1，0，null**；

#### **符号运算符**

`=`

如果等号两边即存在数值，也存在字符串，则字符串存在隐式转换，如果转换数值不成功，就转换为0；

如果等号两边都为字符串，则会比较两者的ASCII码值是否相同；

如果等号两边的表达式存在null值，则结果为null；

`<=>` **安全等于**

与等号的作用相似，唯一的不同是可以用来对null值进行判断，在两个操作数均为null时，返回1；当一个操作数为null时，返回0；

`<>` **不等于**

不能判断null值；

**判断一个字段是否为NULL**

NOT fields <=> NULL;

注：NOT否定它之后的所有条件；

fields+IS NULL

ISNULL(fields)

#### 非符号运算符

**ISNULL/IS NOT NULL**

**LEAST()/GREATEST()**

LEAST(value1,value2……)；

**BETWEEN……AND……**

```mysql
SELECT ID FROM emp WHERE ID BETWEEN 15 AND 17；
SELECT ID,`name` FROM emp WHERE NOT ID BETWEEN 15 AND 17
```

查询满足两个条件之间的数据，包含边界；条件上界和条件下界不能交换；

**in （set）/not in （set）**

```mysql
SELECT ID,`name` FROM emp WHERE ID IN (15,17)
```

**LIKE模糊查询**

**`%`**代表不确定个数的字符（0/1/多个）；

**`_`**代表一个不确定的字符

`\` 转义字符

```mysql
SELECT `name` FROM emp WHERE `name` LIKE '_\_'
SELECT `name` FROM emp WHERE `name` LIKE '_$_' ESCAPE '$'
```

**REGEXP/RLIKE正则表达式**

### 逻辑运算符

`NOT XOR(异或) AND OR` 

SQL处理逻辑运算符时，优先处理**AND**操作符；

## 排序和分页

### 排序

如果没有使用排序操作，默认情况下查询返回的数据是默认情况下添加的数据顺序；

我们可以使用列的别名进行排序，只能在`ORDER BY` 使用，不能再`WHERE` 里使用；

注：指令从`FROM`开始，然后查询过滤条件，最后执行`SELECT,ORDER BY` 等语句；

使用`ORDER BY` 排序

```mysql
SELECT ID,name FROM emp ORDER BY ID
```

升序：`ASC` 

降序：`DESC` 

### 分页

#### limit

`LIMIT`  偏移量，记录量；

偏移量=（显示页数-1）*记录量；

## 多表查询

容易进行高并发，效率高；避免IO交互浪费；避免数据冗余

### 笛卡尔积

```mysql
SELECT employee_id,department_name FROM employees,departments;
```

错误原因：缺少多表的连接，误认为是交叉连接；

#### 产生情况

缺少多表连接；

连接条件（关联条件）无效；

所有表的所有行相互连接；

#### 注

如果查询语句出现了多个表都存在的字段，则必须指明此字段所在的表；

在FROM语句中定义表的别名，则在SELECT，WHERE语句中必须使用表的别名，而不能使用表的原名；

如果有n个表实现多表的查询，则需要至少n-1个条件；

### 分类

#### 等值连接-非等值连接

#### 自连接-非自连接

#### 内连接-外连接

**内连接**：合并具有同一列的两个以上的表的行，结果集中不包含一个表与另一个表不匹配的行；

**外连接**：合并具有同一列的两个以上的表的行，结果集中除了包含一个表与另一个表匹配的行之外，还查询到了左表与右表不匹配的行；

- 左外连接
- 右外连接
- 满外连接

***SQL92***

- 实现外连接使用“+”符号（MySQL方法不支持此种查询方式）；
- 左表加+左外连接；

***SQL99***

使用`JOIN...ON` 的方法实现多表查询，MySQL支持；

- 内连接

```mysql
SELECT last_name department_name FROM employee e INNER JOIN departments d 
ON e.employee_id=d.employee_id;
```

JOIN 表名 ON 条件；

- 外连接

```mysql
SELECT last_name department_name FROM employee e OUTER JOIN departments d 
ON e.employee_id=d.employee_id;
```

1. 左外连接`LEFT OUTER` （OUTER可省略）
2. 右外连接`RIGHT OUTER` 

- 满外连接:MySQL不支持

```mysql
SELECT last_name department_name FROM employee e FULL OUTER JOIN departments d 
ON e.employee_id=d.employee_id;
```

